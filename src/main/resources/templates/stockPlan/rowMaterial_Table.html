<!DOCTYPE html>
<html lang='en' xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layouts/layout1}">
<body>
<th:block layout:fragment="content">
    <div class="container1">
        <form name="searchForm" method="GET" th:object="${searchDto}" th:action="@{/rowMaterial/search}" style="text-align:center; display: flex; align-items: center; padding:10px 0;">
            <label>기간
                <input type="date" id="startDay" placeholder="시작날짜" th:field="*{start}">
                ~

            <input type="date" id="EndDay"  placeholder="종료날짜" th:field="*{end}">
            </label>
            <label style="padding-left: 50px; padding-right: 30px">재고명
            <input class="search-input" type="text" id="ingredientName" th:field="*{keyword}" placeholder="재고명을 입력하세요">
            </label>
            <label>
                <input class="search-box-icon" type="button" id="search_btn" onclick="getSearchList()" value="조회" style="width: 45px; height: 30px"></label>
        </form>
        <button type="button" class="btn btn-primary" id="rowStock_input" value="입고 등록">
        입고 등록</button>
        <button type="button" class="btn btn-danger" id="rowStock_output" value="출고">
        출고</button>
<table id="Table" class="table table-striped table-bordered table-hover" th:width="900px" style="text-align: center">
    <thead>
    <tr>
        <th> </th>
        <th>id</th>
        <th>수주번호</th>
        <th>발주코드</th>
        <th>발주처</th>
        <th>자재명</th>
        <th>재고량</th>
        <th>입고일자</th>
    </tr>
    </thead>
    <tbody id="#boardtable">

    </tbody>
</table>
        <script th:inline="javascript">
            var table = null;
            $(document).ready(function() {
                table = $('#Table').DataTable({
                    searching: false,
                    responsive: true,
                    destroy: true,
                    processing: true,
                    serverSide: false,
                    ordering: true,
                    scrollX: true,
                    info:false,
                    select: {
                        style: 'multi',
                        selector: 'td:first-child',
                        headerCheckbox: 'select-page'
                    },
                    columnDefs: [
                        {
                            orderable: false,
                            render: DataTable.render.select(),
                            targets: 0
                        }
                    ],
                    layout: {
                        topStart: {
                            buttons: [
                                {
                                    extend: 'colvis',
                                    text: "선택",
                                },
                                {
                                    extend: 'copy',
                                    text: "복사",
                                },
                                {
                                    extend: 'excel',
                                    text: "엑셀",
                                },

                            ]
                        },
                        bottomStart: {
                            paging: {
                                numbers: 3
                            }
                        },
                        bottomEnd: {

                        }
                    },
                    ajax: {
                        url: 'http://localhost:8080/api/getRowStockList',
                        type: 'GET',
                        dataFilter: function(res) {
                            var json = $.parseJSON(res);

                            var data = {
                                'draw': json.data.draw,
                                'recordsTotal': json.data.recordsTotal,
                                'recordsFiltered': json.data.recordsFiltered,
                                'data': json.data,
                            };

                            return JSON.stringify(data);
                        }
                    },
                    columns: [
                        {title: ""},
                        {data: 'id'},
                        {data: 'order_Number.order_Number'},
                        {data: 'ingredient_Code'},
                        {data: 'company_name'},
                        {data: 'materials_Name'},
                        {data: 'ingredient_Amount'},
                        {data: 'in_date'},
                    ]
                })
            });

            $('#rowStock_input').on("click", function(e){
                let popURL = "/rowStockRegister";
                let popOption = "width=650px, height=550px, top=300px, left=300px, scrollbars=yes";

                window.open(popURL, "입고 등록", popOption);
            })

            function getSearchList(){

                fetch('/api/rowMaterial/search', {
                    method: "POST",
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        start: document.getElementById("startDay").value,
                        end: document.getElementById("EndDay").value,
                        keyword: document.getElementById("ingredientName").value
                    }),
                })
                    .then(response => response.json())
                    .then(searchList => {
                        console.log(searchList);

                        table.clear();
                        table.rows.add(searchList);
                        table.draw();


                    })

            }
        </script>

    </div>
</th:block>
</body>
</html>